package org.liprudent.majiang.engine.tile.impl

import org.liprudent.majiang.engine.tile._

class SpecialOrdered extends           StringToTile("ESWNGRB1b2b3b4b5b6b 8b9b1c2c3c4c5c6c7c8c9c1s2s 3s4s5s6s7s8s9sESWNGR B1b2b3b4b5b6b7b8b9b1c2c3c 7b4c5c6c7c8c9c1s2s3s4s5s6s7s8s9sESWNGRB1b2b3b4b5b6b7b8b9b1c2c3c4c5c6c7c8c9c1s2s3s4s5s6s7s8s9sESWNGRB1b2b3b4b5b6b7b8b9b1c2c3c4c5c6c7c8c9c1s2s3s4s5s6s7s8s9s"){}
class SpecialChow extends              StringToTile("ESWNGRB1b2b3b4b5b6b 8b9b1c2c3c4c5c6c7c8c9c1s2s 3s4s5s6s7s8s9sESWNGR B1b2b3b4b5b6b7b8b9b1c2c3c 7b1b5c6c7c8c9c1s2s3s4s5s6s7s8s9sESWNGRB4c2b3b4b5b6b7b8b9b1c2c3c4c5c6c7c8c9c1s2s3s4s5s6s7s8s9sESWNGRB1b2b3b4b5b6b7b8b9b1c2c3c4c5c6c7c8c9c1s2s3s4s5s6s7s8s9s"){}
class SpecialPung extends              StringToTile("EESWNGRB1b2b3b4b5b GG9b1c2c3c4c5c6c7c8c9c1s 2s3s4s5s6s7s8s9sSWN7bR B1b2b3b4b5b6b7b8b9b1c2c3c 3b3b6bE4c5c6c7c8c9c1s2s3s4s5s6s7s8s9sSWN8bRB1b2b4b5b6b7b8b9b1c2c3c4c5c6c7c8c9c1s2s3s4s5s6s7s8s9sESWNGRB1b2b4b5b6b7b8b9b1c2c3c4c5c6c7c8c9c1s2s3s4s5s6s7s8s9s"){}
class SpecialKong extends              StringToTile("EEEWNGRB1b2b3b4b5b 7b8b9b1c2c3c4c5c6c7c8c9c1s 2s3s4s5s6s7s8s9sSWNGR B1b2b3b4b5b6b7b8b9b1c2c3c 6bES4c5c6c7c8c9c1s2s3s4s5s6s7s8s9sSWNGRB1b2b3b4b5b6b7b8b9b1c2c3c4c5c6c7c8c9c1s2s3s4s5s6s7s8s9sSWNGRB1b2b3b4b5b6b7b8b9b1c2c3c4c5c6c7c8c9c1s2s3s4s5s6s7s8s9s"){}
class SpecialKong2 extends             StringToTile("ESWNGRB1b2b3b4b5b6b 8b9b1c2c3c4c5c6c7c8cEEE 9c1s2s3s4s5s6s7s8s9sSWN GRB1b2b3b4b5b6b7b8b9b1c 7b2c3c4c5c6c7c8c9c1s2s3s4s5s6s7s8s9sSWNGRB1b2b3b4b5b6b7b8b9b1c2c3c4c5c6c7c8c9c1s2s3s4s5s6s7s8s9sSWNGRB1b2b3b4b5b6b7b8b9b1c2c3c4c5c6c7c8c9c1s2s3s4s5s6s7s8s9s"){}
class SpecialOpenKong extends          StringToTile("EESWNGRB1b2b3b4b5b GG9b1c2c3c4c5c6c7c8c9c1s 2s3s4s5s6s7s8s9sSWN7bR B1b2b3b4b5b6b7b8b9b1c2c3c 3bE3b6bE4c5c6c7c8c9c1s2s3s4s5s6s7s8s9sSWN8bRB1b2b4b5b6b7b8b9b1c2c3c4c5c6c7c8c9c1s2s3s4s5s6s7s8s9sSWNGRB1b2b4b5b6b7b8b9b1c2c3c4c5c6c7c8c9c1s2s3s4s5s6s7s8s9s"){}
class SpecialKongDeclareHidden extends StringToTile("EEEEWWWWNNB1b2b3b SSSS2c3c4c5c6c7c8c9c1s 2s3s4s5s6s7s8s9s7b4b5bGR B1b2b3b4b5b6b7b8b9b1c2c3c N6b8bN4c5c6c7c8c9c1s2s3s4s5s6s7s8s9sGGRB1b2b3b4b5b6b7b8b9b1c2c3c4c5c6c7c8c9c1s2s3s4s5s6s7s8s9sRGRB1b2b3b4b5b6b7b8b9b1c2c3c4c5c6c7c8c9c1s2s3s4s5s6s7s8s9s9b1c"){}
class SpecialDeclareMahjong extends    StringToTile("1b2b3b4b5b6b7b8b9b1c2c3c4c ESWNGRB6c7c8c9c1s2s 3s4s5s6s7s8s9sESWNGR B1b2b3b4b5b6b7b8b9b1c2c3c 4c5c5c6c7c8c9c1s2s3s4s5s6s7s8s9sESWNGRB1b2b3b4b5b6b7b8b9b1c2c3c4c5c6c7c8c9c1s2s3s4s5s6s7s8s9sESWNGRB1b2b3b4b5b6b7b8b9b1c2c3c4c5c6c7c8c9c1s2s3s4s5s6s7s8s9s"){}
class SpecialEatMahjong extends        StringToTile("1b2b3b4b5b6b7b8b9b1c2c3c4c ESWNGRB6c7c8c9c1s2s 3s4s5s6s7s8s9sESWNGR B1b2b3b4b5b6b7b8b9b1c2c3c 5c4c4c5c6c7c8c9c1s2s3s4s5s6s7s8s9sESWNGRB1b2b3b4b5b6b7b8b9b1c2c3c5c6c7c8c9c1s2s3s4s5s6s7s8s9sESWNGRB1b2b3b4b5b6b7b8b9b1c2c3c4c5c6c7c8c9c1s2s3s4s5s6s7s8s9s"){}

class StringToTile(_s : String) {
	
	//remove white spaces
	val s = _s.replaceAll(" ","")
	
	//init map
	val mapCpt = scala.collection.mutable.Map("E"->0,"S"->0,"N"->0,"W"->0,"G"->0,"R"->0,"B"->0)
	List("c","b","s").foreach(s => List.range(1,10).foreach(v => mapCpt.put(v.toString+s,0)))	
	
	
	def toTiles : List[ITile] = {
		def honors(h:String) : ITile= {
		  val i = mapCpt.get(h).get
		  mapCpt.put(h,i+1)
		  h match {
			case "E" => new TileHonorEast(i)
			case "S" => new TileHonorSouth(i)
			case "N" => new TileHonorNorth(i)
			case "W" => new TileHonorWest(i)
			case "R" => new TileHonorRed(i)
			case "G" => new TileHonorGreen(i)
			case "B" => new TileHonorWhite(i)
		  }
		}
		
		def suits(s:String,v:Int) : ITile = {
		  val i = mapCpt.get(v.toString+s).get
		  mapCpt.put(v.toString+s,i+1)
			s match {
				case "b" => new TileSuitBamboo(i,v)
				case "c" => new TileSuitCharacter(i,v)
				case "s" => new TileSuitStone(i,v)
			}
		}
			
		
		def multiple(m:String) : List[ITile] = {
			val MultipleHonor = """(\d)([ESNWRGB])""".r
			val NoMultipleHonor = """([ESNWRGB])""".r
			val MultipleSuit = """(\d)(\d)([bsc])""".r
			val NoMultipleSuit = """(\d)([bsc])""".r
			m match {
				case MultipleHonor(factor,honor) => (0 until factor.toInt).map(i=>honors(honor)).toList
				case NoMultipleHonor(honor)=> List(honors(honor))
				case NoMultipleSuit(value,suit)=> List(suits(suit,value.toInt))
				case MultipleSuit(factor,value,suit)=> (0 until factor.toInt).map(i=>suits(suit,value.toInt)).toList
			}
		}
		val pattern = """([1-4]?E|[1-4]?S|[1-4]?N|[1-4]?W|[1-4]?R|[1-4]?G|[1-4]?B|[1-4]?[1-9]b|[1-4]?[1-9]c|[1-4]?[1-9]s)+?""".r
		
		pattern.findAllIn(s).toList.map(multiple(_)).flatten
	}
}


object ToTiles  {
	def apply(s:String):List[ITile] = {
		new StringToTile(s).toTiles	
	}
}

object ToTile  {
	def apply(s:String):ITile = {
		val ret = new StringToTile(s).toTiles	
		if(ret.size != 1) throw new IllegalArgumentException("Input string produced several tiles");
		else return ret(0)
	}
}
